{% extends "base.html" %}

{% block title %}Debug Information - VULNERÁVEL{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="text-danger"><i class="fas fa-bug"></i> Debug Information</h1>
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>VULNERABILIDADE CRÍTICA:</strong> 
            Esta página expõe informações sensíveis do sistema em produção!
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5><i class="fas fa-user-secret"></i> Dados da Sessão</h5>
            </div>
            <div class="card-body">
                <pre class="bg-light p-3 rounded">{{ debug_data.session | tojson(indent=2) }}</pre>
            </div>
        </div>
        
        <div class="card border-warning mt-3">
            <div class="card-header bg-warning">
                <h5><i class="fas fa-globe"></i> Headers da Requisição</h5>
            </div>
            <div class="card-body">
                <pre class="bg-light p-3 rounded">{{ debug_data.request_headers | tojson(indent=2) }}</pre>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5><i class="fas fa-key"></i> Configurações Sensíveis</h5>
            </div>
            <div class="card-body">
                <h6>Chave Secreta:</h6>
                <code class="text-danger">{{ debug_data.secret_key }}</code>
                
                <h6 class="mt-3">URL do Banco de Dados:</h6>
                <code class="text-danger">{{ debug_data.database_url }}</code>
                
                <div class="alert alert-danger mt-3">
                    <small>
                        <i class="fas fa-skull-crossbones"></i>
                        <strong>Informações expostas:</strong> Credenciais de banco de dados e chave de sessão!
                    </small>
                </div>
            </div>
        </div>
        
        <div class="card border-info mt-3">
            <div class="card-header bg-info text-white">
                <h5><i class="fas fa-server"></i> Variáveis de Ambiente</h5>
            </div>
            <div class="card-body">
                <div style="max-height: 300px; overflow-y: auto;">
                    <pre class="bg-light p-3 rounded small">{{ debug_data.environment_vars | tojson(indent=2) }}</pre>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning">
                <h5><i class="fas fa-exclamation-triangle"></i> Impacto das Vulnerabilidades</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Informações Expostas:</h6>
                        <ul>
                            <li>Chave secreta da aplicação</li>
                            <li>Credenciais do banco de dados</li>
                            <li>Dados de sessão do usuário</li>
                            <li>Variáveis de ambiente do sistema</li>
                            <li>Headers HTTP completos</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Possíveis Ataques:</h6>
                        <ul>
                            <li>Sequestro de sessão</li>
                            <li>Acesso direto ao banco de dados</li>
                            <li>Falsificação de tokens</li>
                            <li>Escalação de privilégios</li>
                            <li>Comprometimento total do sistema</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Interactive vulnerability testing -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5><i class="fas fa-terminal"></i> Teste de Vulnerabilidades Interativo</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Teste de Injeção SQL:</h6>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="sqlInput" 
                                   placeholder="' UNION SELECT password FROM users--">
                            <button class="btn btn-danger" onclick="testSQLInjection()">Testar</button>
                        </div>
                        
                        <h6>Teste de Comando:</h6>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="cmdInput" 
                                   placeholder="ls -la">
                            <button class="btn btn-warning" onclick="testCommand()">Executar</button>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h6>Teste de Leitura de Arquivo:</h6>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="fileInput" 
                                   placeholder="/etc/passwd">
                            <button class="btn btn-info" onclick="testFileRead()">Ler</button>
                        </div>
                        
                        <h6>Informações do Sistema:</h6>
                        <button class="btn btn-secondary" onclick="getSystemInfo()">Ver Info</button>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h6>Resultado:</h6>
                    <pre id="testResult" class="bg-dark text-light p-3 rounded" style="min-height: 100px;"></pre>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function testSQLInjection() {
    const query = document.getElementById('sqlInput').value;
    
    fetch(`/api/search_users?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('testResult').textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
            document.getElementById('testResult').textContent = 'Erro: ' + error;
        });
}

function testCommand() {
    const command = document.getElementById('cmdInput').value;
    
    fetch(`/api/execute_command?cmd=${encodeURIComponent(command)}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('testResult').textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
            document.getElementById('testResult').textContent = 'Erro: ' + error;
        });
}

function testFileRead() {
    const filename = document.getElementById('fileInput').value;
    
    fetch(`/api/read_file?file=${encodeURIComponent(filename)}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('testResult').textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
            document.getElementById('testResult').textContent = 'Erro: ' + error;
        });
}

function getSystemInfo() {
    fetch('/api/system_info')
        .then(response => response.json())
        .then(data => {
            document.getElementById('testResult').textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
            document.getElementById('testResult').textContent = 'Erro: ' + error;
        });
}

// Auto-demonstrate session exposure
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== INFORMAÇÕES SENSÍVEIS EXPOSTAS ===');
    console.log('Secret Key:', '{{ debug_data.secret_key }}');
    console.log('Database URL:', '{{ debug_data.database_url }}');
    console.log('Session Data:', '{{ debug_data.session | tojson }}');
    
    // Simulate session hijacking
    const sessionData = '{{ debug_data.session | tojson }}';
    if (sessionData.user_id) {
        console.log(`Possível sequestro de sessão para usuário ID: ${sessionData.user_id}`);
    }
});
</script>
{% endblock %}

